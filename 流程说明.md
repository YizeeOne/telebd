# 重点交通场景移动网络质量数据集处理与可视化流程说明

本流程针对 `重点交通场景移动网络质量数据集.xlsx` 进行数据清洗、统计分析与可视化输出，覆盖城市对比、运营商对比、场景对比等维度，并生成汇总结论。

## 1. 数据读取与初步检查
- 数据源：`D:\dev\code\py\class\A\重点交通场景移动网络质量数据集.xlsx`
- 工作表：`Cat1`、`NB-IoT`、`Redcap`
- 字段说明来源：`数据集A说明.docx`
- 使用 Pandas 读取 Excel，检查字段数量、缺失率、分类列取值范围
- 发现说明：
  - 运营商字段仅出现 1、2（说明书中给出 3=联通，但本数据未出现）
  - 城市以字母表示（A~J），场景为中文二级场景

## 2. 数据清洗与标准化
对应脚本：`analysis.py`
- 统一基础字段命名（基于前 8 列字段顺序）：
  - `vendor` 设备厂家
  - `city` 地市
  - `scene_l1` 一级场景（DT/CQT）
  - `scene_l2` 二级场景
  - `operator` 运营商
  - `test_distance_km` 测试总里程
  - `test_duration_h` 测试总时长
  - `avg_speed_kmh` 平均车速
- 清洗处理：
  - 去除空白与无效字符串（`nan/None/NaT`）
  - 运营商映射：1=移动，2=电信，3=联通
  - 一级场景映射：DT=驶测，CQT=定点
  - 二级场景保留中文标准名称
  - 非分类字段强制转换为数值型（不可转换为 NaN）
- 输出清洗后的 CSV：
  - `output/cleaned_Cat1.csv`
  - `output/cleaned_NB-IoT.csv`
  - `output/cleaned_Redcap.csv`

## 3. 分析指标与统计策略
- 指标自动选取逻辑（按列名关键字）：
  - RSRP（信号强度）
  - SINR（信号质量）
  - 覆盖率1
  - 下行吞吐率（`y1_` 前缀）
  - 上行吞吐率（`z1_` 前缀）
- 缺失值策略：不做填补，统计时按有效样本计算，同时输出缺失率
- 聚合口径：均值（mean）
  - 城市×运营商
  - 场景×运营商
  - 一级场景×运营商
  - 运营商整体均值
- 加权口径：优先按测试总里程，其次测试总时长
- 稳健统计：IQR 异常值检测与 Winsor 均值
- 综合评分：关键指标归一化后取均值
- 显著性检验：Welch t-test（p < 0.05，需 SciPy）
- 输出聚合表：
  - `output/*_city_operator_mean.csv`
  - `output/*_scene_operator_mean.csv`
  - `output/*_scene1_operator_mean.csv`
  - `output/*_operator_mean.csv`
  - `output/*_operator_weighted.csv`
  - `output/*_operator_robust.csv`
  - `output/*_operator_composite.csv`
  - `output/*_significance.csv`
  - `output/metrics_notes.md`

## 4. 可视化输出
所有图表输出到：`output/figures/`
- 城市-运营商对比柱状图
  - 文件：`*_city_operator_bar.png`
  - 维度：城市为 X，运营商为系列
- 场景趋势图（折线）
  - 文件：`*_scene_trend.png`
  - 维度：二级场景为 X，运营商为系列
- 城市-运营商热力图
  - 文件：`*_city_operator_heatmap.png`
  - 维度：城市×运营商
- 一级场景对比柱状图
  - 文件：`*_scene1_operator_bar.png`
  - 维度：一级场景为 X，运营商为系列
- 运营商雷达图（归一化）
  - 文件：`*_operator_radar.png`
  - 维度：RSRP、SINR、下行吞吐率、上行吞吐率、覆盖率1

为避免中文乱码，Matplotlib 设置了中文字体与负号处理：
- `font.sans-serif = [Microsoft YaHei, SimHei, Arial Unicode MS]`
- `axes.unicode_minus = False`

## 5. 结果总结（自动生成）
汇总文件：`output/summary.md`

主要结论示例（摘要）：
- Cat1：RSRP/SINR 最优为移动；吞吐率最优为电信
- NB-IoT：RSRP/SINR 最优为移动
- Redcap：RSRP/SINR/吞吐率均为移动最优
总结中包含缺失率、加权对比、稳健均值、综合评分与显著性检验提示。

## 6. 产出文件清单
- 脚本：`analysis.py`
- 清洗数据：`output/cleaned_*.csv`
- 聚合表：`output/*_mean.csv`、`output/*_scene1_operator_mean.csv`
- 加权/稳健/综合/显著性：`output/*_operator_weighted.csv`、`output/*_operator_robust.csv`、`output/*_operator_composite.csv`、`output/*_significance.csv`
- 指标说明：`output/metrics_notes.md`
- 图表：`output/figures/*.png`
- 总结：`output/summary.md`

## 7. 复现方式
在项目目录运行：
```bash
python analysis.py
```
运行后会自动更新 `output/` 中的所有结果文件。
